{% extends "base_tailwind.html" %}
{% load i18n %}
{% load heroicons %}
{% load tailwind_forms %}
{% block title %}
    {% translate "Propose Session" %}
{% endblock title %}
{% block header %}
    {% translate "Propose Session" %}
{% endblock header %}
{% block description %}
    {% translate "Submit a session proposal for" %} {{ event.name }}
{% endblock description %}
{% block body %}
    <div class="max-w-3xl mx-auto">
        <div class="card gradient-border">
            {% if time_slot %}
                <div class="px-6 py-4 border-b flex items-start gap-3"
                     style="background-color: var(--theme-info-bg);
                            border-color: var(--theme-info-light)">
                    {% heroicon_outline "clock" class="w-5 h-5 flex-shrink-0 mt-0.5" style="color: var(--theme-info)" %}
                    <div>
                        <strong style="color: var(--theme-info-text)">{% translate "Selected Time Slot:" %}</strong>
                        <div class="text-sm mt-1" style="color: var(--theme-info-text)">
                            {{ time_slot.start_time|date:"l, F j, Y" }}
                            ·
                            {{ time_slot.start_time|date:"G:i" }}–{{ time_slot.end_time|date:"G:i" }}
                        </div>
                    </div>
                </div>
            {% endif %}
            <div class="card-body">
                <form method="post" class="space-y-5">
                    {% csrf_token %}
                    <div>
                        <div class="flex flex-wrap items-baseline justify-between gap-x-2 mb-1.5">
                            <label for="title"
                                   class="text-sm font-medium"
                                   style="color: var(--color-foreground-secondary)">
                                {% translate "Session Title" %} <span style="color: var(--theme-danger)" aria-hidden="true">*</span><span class="sr-only">{% translate "(required)" %}</span>
                            </label>
                            <span class="text-sm" style="color: var(--color-foreground-muted)">
                                {% translate "Choose a clear and engaging title that describes your session." %}
                            </span>
                        </div>
                        <input type="text"
                               class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                               style="background-color: var(--theme-bg-secondary);
                                      border-color: var(--theme-border);
                                      color: var(--color-foreground)"
                               id="title"
                               name="title"
                               required
                               data-random-placeholder
                               maxlength="255">
                    </div>
                    <div>
                        <div class="flex flex-wrap items-baseline justify-between gap-x-2 mb-1.5">
                            <label for="description"
                                   class="text-sm font-medium"
                                   style="color: var(--color-foreground-secondary)">
                                {% translate "Description" %}
                            </label>
                            <span class="text-sm" style="color: var(--color-foreground-muted)">
                                {% translate "Provide a detailed description of your session content and objectives." %}
                            </span>
                        </div>
                        <textarea class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                                  style="background-color: var(--theme-bg-secondary);
                                         border-color: var(--theme-border);
                                         color: var(--color-foreground)"
                                  id="description"
                                  name="description"
                                  rows="4"
                                  data-random-placeholder></textarea>
                    </div>
                    <div>
                        <div class="flex flex-wrap items-baseline justify-between gap-x-2 mb-1.5">
                            <label for="requirements"
                                   class="text-sm font-medium"
                                   style="color: var(--color-foreground-secondary)">
                                {% translate "Requirements" %}
                            </label>
                            <span class="text-sm" style="color: var(--color-foreground-muted)">
                                {% translate "List any requirements or prerequisites for participants." %}
                            </span>
                        </div>
                        <textarea class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                                  style="background-color: var(--theme-bg-secondary);
                                         border-color: var(--theme-border);
                                         color: var(--color-foreground)"
                                  id="requirements"
                                  name="requirements"
                                  rows="3"
                                  data-random-placeholder></textarea>
                    </div>
                    <div>
                        <div class="flex flex-wrap items-baseline justify-between gap-x-2 mb-1.5">
                            <label for="needs"
                                   class="text-sm font-medium"
                                   style="color: var(--color-foreground-secondary)">
                                {% translate "Special Needs" %}
                            </label>
                            <span class="text-sm" style="color: var(--color-foreground-muted)">
                                {% translate "Specify any special equipment or room setup requirements." %}
                            </span>
                        </div>
                        <textarea class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                                  style="background-color: var(--theme-bg-secondary);
                                         border-color: var(--theme-border);
                                         color: var(--color-foreground)"
                                  id="needs"
                                  name="needs"
                                  rows="2"
                                  data-random-placeholder></textarea>
                    </div>
                    {% if tag_categories %}
                        <div role="group" aria-labelledby="tags-group-label">
                            <span id="tags-group-label"
                                  class="block text-sm font-medium mb-3"
                                  style="color: var(--color-foreground-secondary)">{% translate "Tags" %}</span>
                            <div class="space-y-4">
                                {% for category in tag_categories %}
                                    <div>
                                        <label for="tags_{{ category.id }}"
                                               class="block text-sm mb-1.5"
                                               style="color: var(--color-foreground)">{{ category.name }}</label>
                                        {% if category.input_type == 'select' %}
                                            <select multiple
                                                    class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                                                    style="background-color: var(--theme-bg-secondary);
                                                           border-color: var(--theme-border);
                                                           color: var(--color-foreground)"
                                                    id="tags_{{ category.id }}"
                                                    name="tags_{{ category.id }}"
                                                    size="4">
                                                {% for cat_id, tags_list in confirmed_tags.items %}
                                                    {% if cat_id == category.id|stringformat:"s" %}
                                                        {% for tag in tags_list %}<option value="{{ tag.id }}">{{ tag.name }}</option>{% endfor %}
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                            <p class="text-sm mt-1.5 hidden sm:block"
                                               style="color: var(--color-foreground-muted)">
                                                {% translate "Hold Ctrl/Cmd to select multiple tags." %}
                                            </p>
                                            <p class="text-sm mt-1.5 sm:hidden"
                                               style="color: var(--color-foreground-muted)">
                                                {% translate "Tap to select multiple tags." %}
                                            </p>
                                        {% elif category.input_type == 'type' %}
                                            <input type="text"
                                                   class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                                                   style="background-color: var(--theme-bg-secondary);
                                                          border-color: var(--theme-border);
                                                          color: var(--color-foreground)"
                                                   id="tags_{{ category.id }}"
                                                   name="tags_{{ category.id }}"
                                                   placeholder="{% translate "e.g. horror, investigation, sandbox" %}">
                                            <p class="text-sm mt-1.5" style="color: var(--color-foreground-muted)">
                                                {% translate "Comma-separated. New tags will be reviewed by organizers." %}
                                            </p>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="flex flex-wrap items-baseline justify-between gap-x-2 mb-1.5">
                                <label for="participants_limit"
                                       class="text-sm font-medium"
                                       style="color: var(--color-foreground-secondary)">
                                    {% translate "Participants" %}
                                </label>
                                <span class="text-sm" style="color: var(--color-foreground-muted)">
                                    {% translate "How many players can join your session?" %}
                                </span>
                            </div>
                            <input type="text"
                                   inputmode="numeric"
                                   pattern="[0-9]*"
                                   class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                                   style="background-color: var(--theme-bg-secondary);
                                          border-color: var(--theme-border);
                                          color: var(--color-foreground)"
                                   id="participants_limit"
                                   name="participants_limit"
                                   placeholder="{% translate "e.g. 5" %}"
                                   required>
                        </div>
                        <div>
                            <label for="min_age"
                                   class="block text-sm font-medium mb-1.5"
                                   style="color: var(--color-foreground-secondary)">
                                {% translate "Age Rating" %} <span style="color: var(--theme-danger)" aria-hidden="true">*</span><span class="sr-only">{% translate "(required)" %}</span>
                            </label>
                            <select class="w-full px-3 py-2.5 rounded-lg border focus:outline-none focus:ring-2"
                                    style="background-color: var(--theme-bg-secondary);
                                           border-color: var(--theme-border);
                                           color: var(--color-foreground)"
                                    id="min_age"
                                    name="min_age"
                                    required>
                                <option value="3">{% translate "PEGI 3" %}</option>
                                <option value="7">{% translate "PEGI 7" %}</option>
                                <option value="12">{% translate "PEGI 12" %}</option>
                                <option value="16">{% translate "PEGI 16" %}</option>
                                <option value="18">{% translate "PEGI 18" %}</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex flex-col-reverse sm:grid sm:grid-cols-2 gap-3 pt-4">
                        <a href="{% url 'web:chronology:event' slug=event.slug %}"
                           class="btn btn-secondary py-3">
                            {% heroicon_outline "arrow-left" class="w-5 h-5" %}
                            {% translate "Back to Event" %}
                        </a>
                        <button type="submit" class="btn btn-primary py-3">
                            {% heroicon_outline "paper-airplane" class="w-5 h-5" %}
                            {% translate "Submit Proposal" %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div class="card mt-6">
            <div class="card-body">
                <p class="text-sm text-foreground-muted">
                    {% translate "Proposals are reviewed by organizers. You'll be notified when yours is accepted and added to the agenda." %}
                    {% if not time_slot %}
                        {% translate "Organizers will assign time slots to accepted proposals." %}
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
    <script>
        {
            # Random example placeholders— one coherent set per RPG system #
        }
        var _ph = [{
            title: "{% translate "
            e.g.Curse of Strahd— one - shot
            for beginners " %}",
            description: "{% translate "
            e.g.A gothic horror adventure in Barovia.We create characters together and play through a haunted castle.No experience needed,
            I will teach the rules as we go.
            " %}",
            requirements: "{% translate "
            e.g.Know basic D & D 5 e rules.Bring your own dice and a level 3 character(or come 15 min early to make one).
            " %}",
            needs: "{% translate "
            e.g.Large table
            for maps and minis,
            power outlet
            for laptop " %}"
        }, {
            title: "{% translate "
            e.g.A Pound of Flesh— survival horror in deep space " %}",
            description: "{% translate "
            e.g.You are crew on a deep - space fuel station.Something has gone wrong.Survive,
            escape,
            or die trying.Mothership is rules - light and beginner - friendly.
            " %}",
            requirements: "{% translate "
            e.g.No experience needed.Characters are created in 10 minutes at the table.
            " %}",
            needs: "{% translate "
            e.g.Dim lighting preferred
            for atmosphere " %}"
        }, {
            title: "{% translate "
            e.g.Honey in the Rafters— a Mausritter adventure " %}",
            description: "{% translate "
            e.g.Play as brave mice exploring a dangerous world.We venture into an abandoned farmhouse to find a legendary honey cache.Light,
            fast rules— great
            for newcomers.
            " %}",
            requirements: "{% translate "
            e.g.None— rules are simple and we make characters at the table.Good
            for ages 8 + .
            " %}",
            needs: "{% translate "
            e.g.Colored pencils and blank paper
            for mapping " %}"
        }, {
            title: "{% translate "
            e.g.The Sword— a tense Burning Wheel one - shot " %}",
            description: "{% translate "
            e.g.Three lords,
            one ancient sword,
            and conflicting Beliefs.A drama - heavy one - shot focused on negotiation,
            betrayal,
            and hard choices.No dice needed until someone breaks.
            " %}",
            requirements: "{% translate "
            e.g.Read the Hub and Spokes section of the rulebook.Pre - generated characters provided.
            " %}",
            needs: "{% translate "
            e.g.Quiet room— this game needs focused conversation " %}"
        }, {
            title: "{% translate "
            e.g.Burned Over— life after the apocalypse " %}",
            description: "{% translate "
            e.g.The world ended.Now what ? We build a community together and see what happens when scarcity forces hard choices.Collaborative,
            fiction - first play.
            " %}",
            requirements : "{% translate "
            e.g.No prep needed.Pick a playbook at the table.Some mature themes—
            for players 16 + .
            " %}",
            needs: "{% translate "
            e.g.Whiteboard or large paper
            for relationship maps " %}"
        }];
        var _i = Math.floor(Math.random() * _ph.length),
            _s = _ph[_i];
        document.getElementById("title").placeholder = _s.title;
        document.getElementById("description").placeholder = _s.description;
        document.getElementById("requirements").placeholder = _s.requirements;
        document.getElementById("needs").placeholder = _s.needs;
    </script>
{% endblock body %}
