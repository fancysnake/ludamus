{% extends "base_tailwind.html" %}
{% load i18n %}
{% load heroicons %}
{% block title %}
    {% if time_slot %}
        {% translate "Propose Session for" %} {{ time_slot.start_time|date:"l, F j - G:i" }}
    {% else %}
        {% translate "Propose Session" %}
    {% endif %}
{% endblock title %}
{% block header %}
    {% if time_slot %}
        {% translate "Propose Session for Time Slot" %}
    {% else %}
        {% translate "Propose Session" %}
    {% endif %}
{% endblock header %}
{% block description_text %}
    {% if time_slot %}
        {% translate "Submit a session proposal for" %} {{ event.name }} - {{ time_slot.start_time|date:"l, F j" }} {{ time_slot.start_time|date:"G:i" }} to {{ time_slot.end_time|date:"G:i" }}
    {% else %}
        {% translate "Submit a session proposal for" %} {{ event.name }}
    {% endif %}
{% endblock description_text %}
{% block body %}
    <div class="max-w-3xl mx-auto">
        <!-- Proposal Form Card -->
        <div class="rounded-lg card-shadow overflow-hidden mb-6"
             style="background-color: var(--theme-bg-secondary)">
            <div class="px-4 py-3 flex items-center"
                 style="background-color: var(--theme-warning);
                        color: var(--theme-text-inverse)">
                {% heroicon_outline "light-bulb" class="w-5 h-5 mr-2" %}
                <h2 class="font-semibold">
                    {% if time_slot %}
                        {% translate "Propose Session for Time Slot" %}
                    {% else %}
                        {% translate "Propose New Session" %}
                    {% endif %}
                </h2>
            </div>
            <div class="p-6">
                {% if time_slot %}
                    <div class="flex items-start p-4 rounded mb-6"
                         style="background-color: var(--theme-info-bg);
                                border: 1px solid var(--theme-info-light);
                                color: var(--theme-info-text)">
                        {% heroicon_outline "clock" class="w-5 h-5 mr-3 flex-shrink-0" %}
                        <div>
                            <strong>{% translate "Selected Time Slot:" %}</strong>
                            <br>
                            {{ time_slot.start_time|date:"l, F j, Y" }}
                            <br>
                            {{ time_slot.start_time|date:"G:i" }} - {{ time_slot.end_time|date:"G:i" }}
                        </div>
                    </div>
                {% endif %}
                <form method="post">
                    {% csrf_token %}
                    <!-- Title -->
                    <div class="mb-4">
                        <label for="title"
                               class="block text-sm font-medium mb-1"
                               style="color: var(--theme-text-secondary)">
                            {% heroicon_outline "document-text" class="w-4 h-4 inline mr-1" %}
                            {% translate "Session Title" %}
                            <span style="color: var(--theme-danger);">*</span>
                        </label>
                        <input type="text"
                               class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1"
                               style="background-color: var(--theme-bg-secondary);
                                      border-color: var(--theme-border);
                                      color: var(--theme-text)"
                               id="title"
                               name="title"
                               required
                               placeholder="{% translate "Enter a compelling title for your session" %}"
                               maxlength="255">
                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                            {% translate "Choose a clear and engaging title that describes your session." %}
                        </p>
                    </div>
                    <!-- Description -->
                    <div class="mb-4">
                        <label for="description"
                               class="block text-sm font-medium mb-1"
                               style="color: var(--theme-text-secondary)">
                            {% heroicon_outline "document" class="w-4 h-4 inline mr-1" %}
                            {% translate "Description" %}
                        </label>
                        <textarea class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1 min-h-[100px]"
                                  style="background-color: var(--theme-bg-secondary);
                                         border-color: var(--theme-border);
                                         color: var(--theme-text)"
                                  id="description"
                                  name="description"
                                  rows="4"
                                  placeholder="{% translate 'Describe what your session is about, what participants will learn or do...' %}"></textarea>
                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                            {% translate "Provide a detailed description of your session content and objectives." %}
                        </p>
                    </div>
                    <!-- Requirements -->
                    <div class="mb-4">
                        <label for="requirements"
                               class="block text-sm font-medium mb-1"
                               style="color: var(--theme-text-secondary)">
                            {% heroicon_outline "clipboard-document-list" class="w-4 h-4 inline mr-1" %}
                            {% translate "Requirements" %}
                        </label>
                        <textarea class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1 min-h-[80px]"
                                  style="background-color: var(--theme-bg-secondary);
                                         border-color: var(--theme-border);
                                         color: var(--theme-text)"
                                  id="requirements"
                                  name="requirements"
                                  rows="3"
                                  placeholder="{% translate 'Any prerequisites, skills, or materials participants should have...' %}"></textarea>
                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                            {% translate "List any requirements or prerequisites for participants." %}
                        </p>
                    </div>
                    <!-- Special Needs -->
                    <div class="mb-4">
                        <label for="needs"
                               class="block text-sm font-medium mb-1"
                               style="color: var(--theme-text-secondary)">
                            {% heroicon_outline "wrench-screwdriver" class="w-4 h-4 inline mr-1" %}
                            {% translate "Special Needs" %}
                        </label>
                        <textarea class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1"
                                  style="background-color: var(--theme-bg-secondary);
                                         border-color: var(--theme-border);
                                         color: var(--theme-text)"
                                  id="needs"
                                  name="needs"
                                  rows="2"
                                  placeholder="{% translate 'Equipment, room setup, technical requirements...' %}"></textarea>
                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                            {% translate "Specify any special equipment or room setup requirements." %}
                        </p>
                    </div>
                    <!-- Tags Section -->
                    {% if tag_categories %}
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2"
                                   style="color: var(--theme-text-secondary)">
                                {% heroicon_outline "tag" class="w-4 h-4 inline mr-1" %}
                                {% translate "Tags" %}
                            </label>
                            {% for category in tag_categories %}
                                <div class="mb-3">
                                    <label for="tags_{{ category.id }}"
                                           class="block text-sm mb-1"
                                           style="color: var(--theme-text)">{{ category.name }}</label>
                                    {% if category.input_type == 'select' %}
                                        <select multiple
                                                class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1"
                                                style="background-color: var(--theme-bg-secondary);
                                                       border-color: var(--theme-border);
                                                       color: var(--theme-text)"
                                                id="tags_{{ category.id }}"
                                                name="tags_{{ category.id }}"
                                                size="4">
                                            {% for cat_id, tags_list in confirmed_tags.items %}
                                                {% if cat_id == category.id|stringformat:"s" %}
                                                    {% for tag in tags_list %}<option value="{{ tag.id }}">{{ tag.name }}</option>{% endfor %}
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                                            {% translate "Hold Ctrl/Cmd to select multiple tags." %}
                                        </p>
                                    {% elif category.input_type == 'type' %}
                                        <input type="text"
                                               class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1"
                                               style="background-color: var(--theme-bg-secondary);
                                                      border-color: var(--theme-border);
                                                      color: var(--theme-text)"
                                               id="tags_{{ category.id }}"
                                               name="tags_{{ category.id }}"
                                               placeholder="{% translate "Enter comma-separated tags..." %}">
                                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                                            {% translate "Enter tag names separated by commas. New tags will be reviewed by organizers." %}
                                        </p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <!-- Participants Limit -->
                    <div class="mb-4">
                        <label for="participants_limit"
                               class="block text-sm font-medium mb-1"
                               style="color: var(--theme-text-secondary)">
                            {% heroicon_outline "users" class="w-4 h-4 inline mr-1" %}
                            {% translate "Participants Limit" %}
                            <span style="color: var(--theme-danger);">*</span>
                        </label>
                        <input type="number"
                               class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1"
                               style="background-color: var(--theme-bg-secondary);
                                      border-color: var(--theme-border);
                                      color: var(--theme-text)"
                               id="participants_limit"
                               name="participants_limit"
                               value="{{ min_participants_limit }}"
                               min="{{ min_participants_limit }}"
                               max="{{ max_participants_limit }}"
                               required>
                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                            {% blocktranslate %}Maximum number of participants ({{ min_participants_limit }}-{{ max_participants_limit }}).{% endblocktranslate %}
                        </p>
                    </div>
                    <!-- Age Rating -->
                    <div class="mb-6">
                        <label for="min_age"
                               class="block text-sm font-medium mb-1"
                               style="color: var(--theme-text-secondary)">
                            {% heroicon_outline "shield-check" class="w-4 h-4 inline mr-1" %}
                            {% translate "Age Rating" %}
                            <span style="color: var(--theme-danger);">*</span>
                        </label>
                        <select class="w-full px-3 py-2 text-sm rounded border focus:outline-none focus:ring-1"
                                style="background-color: var(--theme-bg-secondary);
                                       border-color: var(--theme-border);
                                       color: var(--theme-text)"
                                id="min_age"
                                name="min_age"
                                required>
                            <option value="3">{% translate "PEGI 3" %}</option>
                            <option value="7">{% translate "PEGI 7" %}</option>
                            <option value="12">{% translate "PEGI 12" %}</option>
                            <option value="16">{% translate "PEGI 16" %}</option>
                            <option value="18">{% translate "PEGI 18" %}</option>
                        </select>
                        <p class="text-xs mt-1" style="color: var(--theme-text-muted);">
                            {% translate "Select the appropriate age rating for this session" %}
                        </p>
                    </div>
                    <!-- Buttons -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <button type="submit"
                                class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded transition"
                                style="background-color: var(--theme-warning);
                                       color: var(--theme-text-inverse)">
                            {% heroicon_outline "paper-airplane" class="w-4 h-4 mr-2" %}
                            {% translate "Submit Proposal" %}
                        </button>
                        <a href="{% url 'web:chronology:event' slug=event.slug %}"
                           class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded transition"
                           style="background-color: var(--theme-bg-tertiary);
                                  border: 1px solid var(--theme-border);
                                  color: var(--theme-text)">
                            {% heroicon_outline "arrow-left" class="w-4 h-4 mr-2" %}
                            {% translate "Back to Event" %}
                        </a>
                    </div>
                </form>
            </div>
        </div>
        <!-- Guidelines Card -->
        <div class="rounded-lg card-shadow overflow-hidden"
             style="background-color: var(--theme-bg-secondary)">
            <div class="px-4 py-3" style="background-color: var(--theme-bg-tertiary);">
                <h3 class="flex items-center text-sm font-semibold"
                    style="color: var(--theme-text)">
                    {% heroicon_outline "information-circle" class="w-4 h-4 mr-2" %}
                    {% translate "Proposal Guidelines" %}
                </h3>
            </div>
            <div class="p-4">
                <ul class="text-sm space-y-1" style="color: var(--theme-text-secondary);">
                    <li>• {% translate "Proposals are reviewed by event organizers" %}</li>
                    <li>• {% translate "You will be notified if your proposal is accepted" %}</li>
                    <li>• {% translate "Accepted proposals will be added to the event agenda" %}</li>
                    {% if time_slot %}
                        <li>• {% translate "Your proposal is for a specific time slot, but organizers may adjust scheduling if needed" %}</li>
                    {% else %}
                        <li>• {% translate "Organizers will assign time slots to accepted proposals" %}</li>
                    {% endif %}
                    <li>
                        • {% translate "Make sure your title and description clearly explain what participants will gain from your session" %}
                    </li>
                </ul>
            </div>
        </div>
    </div>
{% endblock body %}
