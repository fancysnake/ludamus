{% load i18n %}
{% load heroicons %}
<div class="session-card-wrapper">
    <div class="session-card card h-full overflow-hidden rounded-[1.75rem] border ring-offset-[.5px] ring-offset-background transition-transform duration-100 ease-out hover:-translate-y-0.5 hover:ring-1 hover:ring-neutral-200 dark:hover:ring-neutral-600{% if not data.is_enrollment_available or data.should_show_as_inactive %} opacity-70{% endif %}{% if data.user_enrolled %} ring-2 ring-coral-400{% endif %}"
         data-title="{{ data.session.title|lower }}"
         data-host="{{ data.session.presenter_name }}"
         data-tags="{% for tag in data.tags %}{{ tag.name }}{% if not forloop.last %},{% endif %}{% endfor %}"
         data-tag-categories="{% for tag in data.tags %}{{ tag.category.name|slugify }}:{{ tag.name }}{% if not forloop.last %};{% endif %}{% endfor %}"
         data-status="{% if ended %}ended{% elif data.is_ongoing %}in-progress{% elif not data.is_enrollment_available %}unavailable{% elif data.is_full %}full{% else %}available{% endif %}"
         data-debug-ended="{{ ended|yesno:'true,false' }}"
         data-debug-is-ongoing="{{ data.is_ongoing|yesno:'true,false' }}"
         data-debug-enrollment-available="{{ data.is_enrollment_available|yesno:'true,false' }}"
         data-debug-is-full="{{ data.is_full|yesno:'true,false' }}"
         data-user-enrolled="{% if data.user_enrolled %}true{% else %}false{% endif %}"
         data-user-waiting="{% if data.user_waiting %}true{% else %}false{% endif %}"
         data-min-age="{{ data.session.min_age }}"
         data-venue="{% if data.loc.area %}{{ data.loc.venue.slug }}{% endif %}"
         style="cursor: pointer; border-color: var(--theme-border)"
         onclick="openModal('sessionDetailModal{{ data.session.pk }}')">
        <div class="flex h-full flex-col px-5 pb-5">
            <div class="-mx-5 mb-4 bg-transparent px-5 pb-6 pt-5">
                <h3 class="text-3xl font-bold leading-tight tracking-tight text-warm-800">
                    {{ data.session.title }}
                </h3>
            </div>

            <div class="flex-1"></div>

            <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-full border-2 font-semibold text-sm flex items-center justify-center"
                     style="border-color: var(--theme-bg-secondary); background-color: var(--color-coral-400); color: white">
                    {{ data.session.presenter_name|slice:":2"|upper }}
                </div>
                <span class="text-lg font-medium" style="color: #5b5048">
                    {% translate "Hosted by" %} {{ data.session.presenter_name }}
                </span>
            </div>

            {% if data.session.description %}
                <p class="text-[1.05rem] leading-8 mb-4 line-clamp-3" style="color: #6c625b">
                    {{ data.session.description }}
                </p>
            {% endif %}

            <div class="flex flex-wrap gap-2 mb-4 grow">
                {% for tag in data.tags %}
                    <span class="px-3 py-1 rounded-2xl text-sm font-medium filterable-tag bg-warm-200/80 dark:bg-neutral-700 text-warm-700 dark:text-neutral-300"
                          title="{{ tag.name }}">
                        {{ tag.name }}
                    </span>
                {% endfor %}
                {% if data.session.min_age > 0 %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-warm-200/90 dark:bg-neutral-700 text-warm-700 dark:text-neutral-300"
                          title="{% translate "Minimum age" %}: {{ data.session.min_age }} {% translate "years" %}">
                        {{ data.session.min_age }}+
                    </span>
                {% else %}
                    <span class="px-2 py-1 rounded-lg text-xs font-medium bg-teal-100/90 dark:bg-teal-900/40 text-teal-700 dark:text-teal-400"
                          title="{% translate "All ages welcome" %}">
                        {% translate "All ages" %}
                    </span>
                {% endif %}
            </div>

            <div class="mt-auto flex items-center justify-between">
                <div class="flex items-center gap-2">
                    {% if data.enrolled_count == 0 %}
                    {% if not ended %}
                        {% if not ended %}
                            <span class="text-sm font-medium text-teal-700 dark:text-teal-400">
                                {% blocktranslate count counter=data.spots_left %}{{ counter }} slot open{% plural %}{{ counter }} slots open{% endblocktranslate %}
                            </span>
                        {% endif %}
                    {% endif %}
                    {% else %}
                        <div class="flex -space-x-2">
                            {% for p in data.session_participations|dictsort:"status"|slice:":3" %}
                                {% if p.status == 'confirmed' %}
                                    <div class="flex h-7 w-7 shrink-0 items-center justify-center rounded-full border-2 text-xs font-semibold text-white"
                                         style="border-color: var(--theme-bg-secondary); background-color: var({% cycle '--color-coral-400' '--color-teal-400' '--color-teal-500' %})">
                                        {{ p.user.name|slice:":1"|upper }}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="text-sm font-medium text-teal-700 dark:text-teal-400">
                            {% blocktranslate count counter=data.spots_left %}{{ counter }} slot open{% plural %}{{ counter }} slots open{% endblocktranslate %}
                        </span>
                    {% endif %}
                    {% if data.session.waiting_count > 0 %}
                        <span class="text-xs font-medium" style="color: var(--theme-warning)">+{{ data.session.waiting_count }} {% translate "waiting" %}</span>
                    {% endif %}
                </div>

                {% if not ended and data.is_enrollment_available and not data.should_show_as_inactive %}
                    {% if not data.is_full %}
                        <span class="text-[1.05rem] font-semibold text-coral-600 dark:text-coral-400">
                            {% blocktranslate count counter=data.spots_left %}{{ counter }} spot left{% plural %}{{ counter }} spots left{% endblocktranslate %}
                        </span>
                    {% endif %}
                {% else %}
                    <span class="text-xs font-medium" style="color: var(--color-foreground-muted)">
                        {% if ended %}
                            {% translate "Ended" %}
                        {% elif data.should_show_as_inactive %}
                            {% translate "In Progress" %}
                        {% else %}
                            {% translate "Not Available" %}
                        {% endif %}
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
