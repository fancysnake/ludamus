{% load i18n %}
{% load heroicons %}
<div class="session-card-wrapper">
    <div class="session-card card rounded-2xl h-full{% if not data.is_enrollment_available or data.should_show_as_inactive or ended %} opacity-60{% endif %}{% if data.user_enrolled %} ring-2 ring-coral-400{% endif %}"
         data-title="{{ data.session.title|lower }}"
         data-host="{{ data.session.presenter_name }}"
         data-tags="{% for tag in data.tags %}{{ tag.name }}{% if not forloop.last %},{% endif %}{% endfor %}"
         data-tag-categories="{% for tag in data.tags %}{{ tag.category.name|slugify }}:{{ tag.name }}{% if not forloop.last %};{% endif %}{% endfor %}"
         data-status="{% if ended %}ended{% elif data.is_ongoing %}in-progress{% elif not data.is_enrollment_available %}unavailable{% elif data.is_full %}full{% else %}available{% endif %}"
         data-debug-ended="{{ ended|yesno:'true,false' }}"
         data-debug-is-ongoing="{{ data.is_ongoing|yesno:'true,false' }}"
         data-debug-enrollment-available="{{ data.is_enrollment_available|yesno:'true,false' }}"
         data-debug-is-full="{{ data.is_full|yesno:'true,false' }}"
         data-user-enrolled="{% if data.user_enrolled %}true{% else %}false{% endif %}"
         data-user-waiting="{% if data.user_waiting %}true{% else %}false{% endif %}"
         data-min-age="{{ data.session.min_age }}"
         data-venue="{% if data.loc.area %}{{ data.loc.venue.slug }}{% endif %}"
         style="cursor: pointer"
         onclick="openModal('sessionDetailModal{{ data.session.pk }}')">
        <div class="p-5 flex flex-col h-full">
            <!-- Status badge row -->
            <div class="flex items-start justify-between mb-3">
                {% if data.user_enrolled %}
                    <span class="px-2.5 py-1 rounded-lg text-xs font-semibold bg-coral-500 text-white">
                        {% translate "You're in!" %}
                    </span>
                {% elif data.user_waiting %}
                    <span class="px-2.5 py-1 rounded-lg text-xs font-semibold" style="background-color: var(--theme-warning); color: white">
                        {% translate "Waiting" %}
                    </span>
                {% elif data.is_full %}
                    <span class="px-2.5 py-1 rounded-lg text-xs font-semibold bg-warm-500 text-white">
                        {% translate "Full" %}
                    </span>
                {% elif data.is_enrollment_available and not ended %}
                    <span class="px-2.5 py-1 rounded-lg text-xs font-semibold bg-teal-500 text-white">
                        {% translate "Open" %}
                    </span>
                {% endif %}
                {% if data.loc.space %}
                    <span class="text-xs px-2 py-1 rounded-lg venue-icon" style="background-color: var(--theme-bg-tertiary); color: var(--color-foreground-muted)">
                        {% if data.loc.area %}{{ data.loc.venue.name }} â€º {% endif %}{{ data.loc.space.name }}
                    </span>
                {% endif %}
            </div>

            <!-- Session Title -->
            <h3 class="font-bold text-lg mb-2" style="color: var(--color-foreground)">{{ data.session.title }}</h3>

            <!-- Host -->
            <div class="flex items-center gap-2 mb-3">
                <div class="w-6 h-6 rounded-full bg-gradient-to-br from-teal-400 to-teal-500 flex items-center justify-center ring-2 ring-white dark:ring-neutral-800">
                    {% heroicon_mini "user" class="w-3.5 h-3.5 text-white" %}
                </div>
                <span class="text-sm" style="color: var(--color-foreground-muted)">{{ data.session.presenter_name }}</span>
            </div>

            <!-- Description -->
            {% if data.session.description %}
                <p class="text-sm mb-4 line-clamp-2" style="color: var(--color-foreground-muted)">
                    {{ data.session.description }}
                </p>
            {% endif %}

            <!-- Tags -->
            <div class="flex flex-wrap gap-2 mb-4 grow">
                {% for tag in data.tags %}
                    <span class="tag-pill px-2 py-1 rounded-lg text-xs font-medium filterable-tag bg-warm-200/90 dark:bg-neutral-700 text-warm-700 dark:text-neutral-300"
                          title="{{ tag.name }}">
                        {{ tag.name }}
                    </span>
                {% endfor %}
                {% if data.session.min_age > 0 %}
                    <span class="tag-pill px-2 py-1 rounded-lg text-xs font-medium bg-warm-200/90 dark:bg-neutral-700 text-warm-700 dark:text-neutral-300"
                          title="{% translate "Minimum age" %}: {{ data.session.min_age }} {% translate "years" %}">
                        {{ data.session.min_age }}+
                    </span>
                {% else %}
                    <span class="tag-pill px-2 py-1 rounded-lg text-xs font-medium bg-teal-100/90 dark:bg-teal-900/40 text-teal-700 dark:text-teal-400"
                          title="{% translate "All ages welcome" %}">
                        {% translate "All ages" %}
                    </span>
                {% endif %}
            </div>

            <!-- Participants + Action -->
            <div class="mt-auto flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="inline-flex items-center gap-1 text-sm" style="color: var(--color-foreground-muted)">
                        {{ data.enrolled_count }}/{{ data.effective_participants_limit }}
                    </span>
                    {% if data.session.waiting_count > 0 %}
                        <span class="text-xs font-medium" style="color: var(--theme-warning)">+{{ data.session.waiting_count }} {% translate "waiting" %}</span>
                    {% endif %}
                </div>

                {% if not ended and data.is_enrollment_available and not data.should_show_as_inactive %}
                    {% if not data.is_full %}
                        <span class="text-sm font-medium text-teal-600 dark:text-teal-400">
                            {% with spots_left=data.effective_participants_limit %}
                                {% translate "Spots open" %}
                            {% endwith %}
                        </span>
                    {% endif %}
                {% else %}
                    <span class="text-xs font-medium" style="color: var(--color-foreground-muted)">
                        {% if ended %}
                            {% translate "Ended" %}
                        {% elif data.should_show_as_inactive %}
                            {% translate "In Progress" %}
                        {% else %}
                            {% translate "Not Available" %}
                        {% endif %}
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
