{% load i18n %}
{% load heroicons %}
<div class="session-card-wrapper">
    <div class="session-card relative block w-full h-full overflow-hidden rounded-2xl bg-neutral-50 dark:bg-neutral-800 border border-neutral-200/50 dark:border-neutral-700/50 ring-offset-[.5px] hover:ring-1 hover:ring-neutral-200 dark:hover:ring-neutral-600 hover:[--pb-scale:1.01] duration-100 ring-offset-background {% if not data.is_enrollment_available or data.should_show_as_inactive %}{% endif %}{% if data.user_enrolled %} ring-2 ring-coral-400{% endif %}"
         data-title="{{ data.session.title|lower }}"
         data-session-id="{{ data.session.pk }}"
         data-host="{{ data.session.presenter_name }}"
         data-tags="{% for tag in data.tags %}{{ tag.name }}{% if not forloop.last %},{% endif %}{% endfor %}"
         data-tag-categories="{% for tag in data.tags %}{{ tag.category.name|slugify }}:{{ tag.name }}{% if not forloop.last %};{% endif %}{% endfor %}"
         data-status="{% if ended %}ended{% elif data.is_ongoing %}in-progress{% elif not data.is_enrollment_available %}unavailable{% elif data.is_full %}full{% else %}available{% endif %}"
         data-debug-ended="{{ ended|yesno:'true,false' }}"
         data-debug-is-ongoing="{{ data.is_ongoing|yesno:'true,false' }}"
         data-debug-enrollment-available="{{ data.is_enrollment_available|yesno:'true,false' }}"
         data-debug-is-full="{{ data.is_full|yesno:'true,false' }}"
         data-user-enrolled="{% if data.user_enrolled %}true{% else %}false{% endif %}"
         data-user-waiting="{% if data.user_waiting %}true{% else %}false{% endif %}"
         data-min-age="{{ data.session.min_age }}"
         data-venue="{{ data.loc.venue.slug }}"
         data-venue-name="{{ data.loc.venue.name }}"
         style="border-color: var(--theme-border)">
        <a href="?session={{ data.session.pk }}"
           class="session-card-link absolute inset-0 z-10 rounded-2xl"
           aria-haspopup="dialog"
           aria-controls="session-{{ data.session.pk }}"
           aria-label="{% blocktranslate with title=data.session.title %}Open details for {{ title }}{% endblocktranslate %}">
            <span class="sr-only">{% blocktranslate with title=data.session.title %}Open details for {{ title }}{% endblocktranslate %}</span>
        </a>
        <div class="relative z-0 flex h-full flex-col px-5 pb-5">
            <div class="-mx-5 bg-transparent px-5 pb-6 pt-5">
                <h3 class="text-3xl font-bold leading-tight tracking-tight text-foreground-primary">{{ data.session.title }}</h3>
            </div>
            <div class="flex-1"></div>
            <div class="flex items-center gap-2 mb-3">
                {% include "components/avatar.html" with user=data.presenter size="size-8" %}
                <span class="text-base font-medium text-foreground-secondary">
                    {% translate "Hosted by" %} {{ data.session.presenter_name }}
                </span>
            </div>
            <div class="flex items-center gap-1.5 mb-3 text-sm text-foreground-secondary">
                {% heroicon_mini "map-pin" class="size-4 shrink-0" %}
                {% if data.loc.space %}
                    <span>
                        {{ data.loc.venue.name }} ›
                        {{ data.loc.area.name }} ›
                        {{ data.loc.space.name }}
                    </span>
                {% else %}
                    <span style="color: var(--color-foreground-muted)">{% translate "TBA" %}</span>
                {% endif %}
            </div>
            {% if data.session.description %}
                <p class="text-sm mb-4 line-clamp-3 text-foreground-primary">{{ data.session.description }}</p>
            {% endif %}
            {% include "chronology/session_tags.html" %}
            <div class="mt-auto flex items-center justify-between">
                <div class="flex items-center gap-2">
                    {% if data.enrolled_count == 0 %}
                        {% if not ended %}
                            <span class="text-sm font-medium text-teal-700 dark:text-teal-400">
                                {% blocktranslate count counter=data.spots_left %}{{ counter }} slot open{% plural %}{{ counter }} slots open{% endblocktranslate %}
                            </span>
                        {% endif %}
                    {% else %}
                        <div class="flex -space-x-2">
                            {% for p in data.session_participations|dictsort:"status"|slice:":3" %}
                                {% if p.status == 'confirmed' %}
                                    {% include "components/avatar.html" with user=p.user size="w-7 h-7" %}
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% if not ended %}
                            <span class="text-sm font-medium text-teal-700 dark:text-teal-400">
                                {% blocktranslate count counter=data.spots_left %}{{ counter }} slot open{% plural %}{{ counter }} slots open{% endblocktranslate %}
                            </span>
                        {% endif %}
                    {% endif %}
                    {% if data.session.waiting_count > 0 %}
                        <span class="text-xs font-medium" style="color: var(--theme-warning)">+{{ data.session.waiting_count }} {% translate "waiting" %}</span>
                    {% endif %}
                </div>
                {% if not ended and data.is_enrollment_available and not data.should_show_as_inactive %}
                    {% if not data.is_full %}
                        <span class="text-[1.05rem] font-semibold text-coral-600 dark:text-coral-400">
                            {% blocktranslate count counter=data.spots_left %}{{ counter }} spot left{% plural %}{{ counter }} spots left{% endblocktranslate %}
                        </span>
                    {% endif %}
                {% else %}
                    <span class="text-xs font-medium"
                          style="color: var(--color-foreground-muted)">
                        {% if ended %}
                            {% translate "Ended" %}
                        {% elif data.should_show_as_inactive %}
                            {% translate "In Progress" %}
                        {% else %}
                            {% translate "Not Available" %}
                        {% endif %}
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
