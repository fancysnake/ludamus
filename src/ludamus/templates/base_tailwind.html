{% load i18n %}
{% load static %}
{% load heroicons %}
{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description"
              content="{% block meta_description %}Event webapp{% endblock meta_description %}">
        <meta name="keywords"
              content="events, conferences, workshops, seminars, meetups, registration, enrollment, sessions, networking, professional development, tech events, design workshops, free events">
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="{{ request.build_absolute_uri }}">
        <meta property="og:title"
              content="{% block og_title %}{{ current_sphere.name }}{% endblock og_title %}">
        <meta property="og:description"
              content="{% block og_description %}Event webapp{% endblock og_description %}">
        <meta property="og:image"
              content="{% block og_image %}https://zagrajmy.net/static/logo.png{% endblock og_image %}">
        <meta property="og:site_name" content="{{ current_sphere.name }}">
        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title"
              content="{% block twitter_title %}{{ current_sphere.name }}{% endblock twitter_title %}">
        <meta name="twitter:description"
              content="{% block twitter_description %}Event webapp{% endblock twitter_description %}">
        <meta name="twitter:image"
              content="{% block twitter_image %}https://zagrajmy.net/static/logo.png{% endblock twitter_image %}">
        <title>
            {% block title %}
                {{ current_sphere.name }}
            {% endblock title %}
        </title>
        <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
        <link rel="shortcut icon"
              type="image/x-icon"
              href="{% static 'favicon.ico' %}">
        <!-- Theme initialization (before CSS to prevent flash) -->
        <script>
            (function() {
                var theme = localStorage.getItem('theme');
                if (theme === 'light' || theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', theme);
                }
            })();
        </script>
        <!-- Tailwind CSS (compiled) -->
        <link rel="stylesheet" href="{% static 'css/output.css' %}?v={{ STATIC_VERSION }}">
        <style>
            /* Card accent line */
            .card-accent {
                position: relative;
            }

            .card-accent::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: var(--theme-accent-gradient, linear-gradient(90deg, #d97706, #f59e0b, #d97706));
            }

            /* Card shadow */
            .card-shadow {
                box-shadow: var(--theme-shadow, 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06));
            }

            .card-shadow:hover {
                box-shadow: var(--theme-shadow-md, 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.05));
            }

            /* Corner mark decoration */
            .corner-mark {
                position: relative;
            }

            .corner-mark::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 12px;
                height: 12px;
                border-left: 2px solid #d97706;
                border-top: 2px solid #d97706;
            }

            .corner-mark::after {
                content: '';
                position: absolute;
                bottom: 0;
                right: 0;
                width: 12px;
                height: 12px;
                border-right: 2px solid #d97706;
                border-bottom: 2px solid #d97706;
            }
        </style>
        {% block extra_head %}
        {% endblock extra_head %}
    </head>
    <body class="flex flex-col min-h-screen font-sans antialiased"
          style="background-color: var(--theme-bg);
                 color: var(--theme-text)">
        <!-- Navbar -->
        <nav class="sticky top-0 z-50 border-b"
             style="background-color: var(--theme-bg-secondary);
                    border-color: var(--theme-border)">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-14">
                    <div class="flex items-center">
                        <a href="{{ request.scheme }}://{{ current_site.domain }}{% url 'web:index' %}"
                           class="flex items-center space-x-2">
                            <!-- Geometric logo -->
                            <div class="w-8 h-8 bg-steel-800 flex items-center justify-center"
                                 style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)">
                                <div class="w-4 h-4 bg-bronze"
                                     style="clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)">
                                </div>
                            </div>
                            <span class="text-xl font-semibold tracking-tight hidden sm:inline">
                                <span class="text-steel-800">{{ current_sphere.name }}</span>
                            </span>
                        </a>
                    </div>
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        {% if request.user.is_authenticated %}
                            {% if request.user.full_name %}
                                <div class="hidden sm:flex items-center text-sm"
                                     style="color: var(--theme-text-secondary)">
                                    <div class="w-8 h-8 rounded bg-steel-700 flex items-center justify-center mr-2">
                                        <span class="text-white text-xs font-medium">{{ request.user.full_name|slice:":2"|upper }}</span>
                                    </div>
                                    <span class="hidden md:inline">{{ request.user.full_name }}</span>
                                </div>
                                <!-- Mobile user avatar -->
                                <div class="sm:hidden w-8 h-8 rounded bg-steel-700 flex items-center justify-center">
                                    <span class="text-white text-xs font-medium">{{ request.user.full_name|slice:":2"|upper }}</span>
                                </div>
                            {% endif %}
                            {% if is_sphere_manager %}
                                <a href="{% url 'panel:index' %}"
                                   class="hidden sm:inline-flex items-center px-3 py-1.5 text-sm font-medium rounded transition"
                                   style="color: var(--theme-text-secondary);
                                          border: 1px solid var(--theme-border)">
                                    {% heroicon_outline "squares-2x2" class="w-4 h-4 mr-1" %}
                                    {% translate "Panel" %}
                                </a>
                            {% endif %}
                            <a href="{% url 'web:crowd:profile' %}"
                               class="hidden sm:inline-flex items-center px-3 py-1.5 text-sm font-medium rounded transition"
                               style="color: var(--theme-text-secondary)">
                                {% heroicon_outline "user-circle" class="w-4 h-4 mr-1" %}
                                {% translate "Profile" %}
                            </a>
                            <a href="{% url 'web:crowd:auth0:logout' %}"
                               class="px-2 sm:px-3 py-1.5 text-sm font-medium rounded transition"
                               style="color: var(--theme-text-secondary)">
                                <span class="hidden sm:inline">{% translate "Logout" %}</span>
                                <span class="sm:hidden">{% heroicon_outline "arrow-right-on-rectangle" class="w-5 h-5" %}</span>
                            </a>
                        {% else %}
                            <a href="{% url 'web:crowd:auth0:login' %}?next={{ request.build_absolute_uri }}"
                               class="inline-flex items-center px-3 py-1.5 text-sm font-medium bg-bronze hover:bg-bronze-dark text-white rounded transition">
                                {% heroicon_outline "arrow-left-on-rectangle" class="w-4 h-4 mr-1" %}
                                {% translate "Login" %}
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </nav>
        <!-- Flash Messages -->
        {% if messages %}
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 space-y-2">
                {% for message in messages %}
                    <div class="p-4 rounded-lg flex items-start {% if message.tags == 'error' %}border{% elif message.tags == 'warning' %}border{% elif message.tags == 'success' %}border{% elif message.tags == 'info' %}border{% else %}border{% endif %}"
                         style="{% if message.tags == 'error' %}background-color: var(--theme-danger-bg);
                                border-color: var(--theme-danger-light);
                                color: var(--theme-danger-text);
                                {% elif message.tags == 'warning' %}background-color: var(--theme-warning-bg);
                                border-color: var(--theme-warning-light);
                                color: var(--theme-warning-text);
                                {% elif message.tags == 'success' %}background-color: var(--theme-success-bg);
                                border-color: var(--theme-success-light);
                                color: var(--theme-success-text);
                                {% elif message.tags == 'info' %}background-color: var(--theme-info-bg);
                                border-color: var(--theme-info-light);
                                color: var(--theme-info-text);
                                {% else %}background-color: var(--theme-bg-tertiary);
                                border-color: var(--theme-border);
                                color: var(--theme-text-secondary);
                                {% endif %}">
                        {% if message.tags == 'error' %}
                            {% heroicon_outline "exclamation-triangle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% elif message.tags == 'warning' %}
                            {% heroicon_outline "exclamation-triangle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% elif message.tags == 'success' %}
                            {% heroicon_outline "check-circle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% elif message.tags == 'info' %}
                            {% heroicon_outline "information-circle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% else %}
                            {% heroicon_outline "chat-bubble-left-ellipsis" class="w-5 h-5 mr-3 flex-shrink-0" %}
                        {% endif %}
                        <span class="text-sm">{{ message }}</span>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        <!-- Main Content -->
        <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 w-full">
            <!-- Page Header -->
            {% block header_section %}
                <div class="mb-6 text-center">
                    <h1 class="text-2xl sm:text-3xl font-bold"
                        style="color: var(--theme-text)">
                        {% block header %}
                        {% endblock header %}
                    </h1>
                    {% block description %}
                        <p class="mt-2 text-sm sm:text-base"
                           style="color: var(--theme-text-muted)">
                            {% block description_text %}
                            {% endblock description_text %}
                        </p>
                    {% endblock description %}
                </div>
            {% endblock header_section %}
            {% block body %}
            {% endblock body %}
        </main>
        <!-- Footer -->
        <footer class="border-t py-6 mt-8"
                style="background-color: var(--theme-bg-secondary);
                       border-color: var(--theme-border)">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm"
                     style="color: var(--theme-text-muted)">
                    <p>
                        © 2025 Radosław Ganczarek.
                        <a href="https://github.com/fancysnake/ludamus"
                           class="hover:underline"
                           style="color: var(--theme-primary)">Source code</a>
                        available under BSD-3-Clause license.
                    </p>
                    <!-- Theme Switcher -->
                    <fieldset class="theme-switcher flex items-center gap-0.5 rounded-lg p-0.5"
                              style="background-color: var(--theme-bg-tertiary)">
                        <legend class="sr-only">{% translate "Select a display theme:" %}</legend>
                        <span class="h-full">
                            <input type="radio" name="theme" value="system" id="theme-system"
                                   class="sr-only peer" checked>
                            <label for="theme-system"
                                   class="flex items-center justify-center w-8 h-8 rounded-md cursor-pointer transition-colors peer-checked:bg-[var(--theme-bg-secondary)]"
                                   style="color: var(--theme-text-muted)"
                                   title="{% translate "System theme" %}">
                                <span class="sr-only">{% translate "system" %}</span>
                                <svg height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentColor">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0.5 3.25C0.5 1.45507 1.95507 0 3.75 0H8.25C10.0449 0 11.5 1.45507 11.5 3.25V11.25V12H10.75H1.25H0.5V11.25V3.25ZM3.75 1.5C2.7835 1.5 2 2.2835 2 3.25V10.5H10V3.25C10 2.2835 9.2165 1.5 8.25 1.5H3.75ZM3 3.5C3 2.94772 3.44772 2.5 4 2.5H8C8.55228 2.5 9 2.94772 9 3.5V7H3V3.5ZM6.5 9.5H9V8H6.5V9.5Z" fill="currentColor" transform="translate(2.5, 2)"/>
                                </svg>
                            </label>
                        </span>
                        <span class="h-full">
                            <input type="radio" name="theme" value="light" id="theme-light"
                                   class="sr-only peer">
                            <label for="theme-light"
                                   class="flex items-center justify-center w-8 h-8 rounded-md cursor-pointer transition-colors peer-checked:bg-[var(--theme-bg-secondary)]"
                                   style="color: var(--theme-text-muted)"
                                   title="{% translate "Light theme" %}">
                                <span class="sr-only">{% translate "light" %}</span>
                                <svg height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentColor">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.75 1V0.25H6.25V1V1.25V2H7.75V1.25V1ZM7 9C8.10457 9 9 8.10457 9 7C9 5.89543 8.10457 5 7 5C5.89543 5 5 5.89543 5 7C5 8.10457 5.89543 9 7 9ZM7 10.5C8.933 10.5 10.5 8.933 10.5 7C10.5 5.067 8.933 3.5 7 3.5C5.067 3.5 3.5 5.067 3.5 7C3.5 8.933 5.067 10.5 7 10.5ZM7.75 12V12.75V13V13.75H6.25V13V12.75V12H7.75ZM12 6.25H12.75H13H13.75V7.75H13H12.75H12V6.25ZM1 6.25H0.25V7.75H1H1.25H2V6.25H1.25H1ZM10.0052 2.93414L10.5355 2.40381L10.7123 2.22703L11.2426 1.6967L12.3033 2.75736L11.773 3.28769L11.5962 3.46447L11.0659 3.9948L10.0052 2.93414ZM2.22703 10.7123L1.6967 11.2426L2.75736 12.3033L3.28769 11.773L3.46447 11.5962L3.9948 11.0659L2.93414 10.0052L2.40381 10.5355L2.22703 10.7123ZM2.93414 3.9948L2.40381 3.46447L2.22703 3.28769L1.6967 2.75736L2.75736 1.6967L3.28769 2.22703L3.46447 2.40381L3.9948 2.93414L2.93414 3.9948ZM10.7123 11.773L11.2426 12.3033L12.3033 11.2426L11.773 10.7123L11.5962 10.5355L11.0659 10.0052L10.0052 11.0659L10.5355 11.5962L10.7123 11.773Z" fill="currentColor" transform="translate(1.25, 1.25)"/>
                                </svg>
                            </label>
                        </span>
                        <span class="h-full">
                            <input type="radio" name="theme" value="dark" id="theme-dark"
                                   class="sr-only peer">
                            <label for="theme-dark"
                                   class="flex items-center justify-center w-8 h-8 rounded-md cursor-pointer transition-colors peer-checked:bg-[var(--theme-bg-secondary)]"
                                   style="color: var(--theme-text-muted)"
                                   title="{% translate "Dark theme" %}">
                                <span class="sr-only">{% translate "dark" %}</span>
                                <svg height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16" style="color: currentColor">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 0.25V1V1.5H11L11.75 1.5V3H11H10.5V3.5V4.25H9V3.5V3H8.5H7.75V1.5H8.5H9V1V0.25H10.5ZM3.25514 2.75496C2.33413 3.53491 1.75 4.69972 1.75 6C1.75 8.34721 3.65279 10.25 6 10.25C7.30029 10.25 8.4651 9.66587 9.24505 8.74485C9.16377 8.74827 9.08207 8.74999 9 8.74999C5.82436 8.74999 3.25 6.17563 3.25 2.99999C3.25 2.91792 3.25172 2.83623 3.25514 2.75496ZM0.25 6C0.25 3.51072 1.83142 1.39271 4.042 0.592193L5.00256 1.55275C4.83933 2.00347 4.75 2.49047 4.75 2.99999C4.75 5.3472 6.65279 7.24999 9 7.24999C9.50953 7.24999 9.99653 7.16065 10.4473 6.99743L11.4078 7.95798C10.6073 10.1686 8.48929 11.75 6 11.75C2.82436 11.75 0.25 9.17564 0.25 6Z" fill="currentColor" transform="translate(2.25, 2.25)"/>
                                </svg>
                            </label>
                        </span>
                    </fieldset>
                </div>
                <div class="mt-4 flex flex-wrap justify-center md:justify-end gap-4 text-sm"
                     style="color: var(--theme-text-muted)">
                    <a href="mailto:{{ SUPPORT_EMAIL }}"
                       class="hover:underline"
                       style="color: var(--theme-primary)">{% translate "Contact" %}</a>
                    <a href="{% url 'django.contrib.flatpages.views.flatpage' url='/privacy-policy/' %}"
                       class="hover:underline"
                       style="color: var(--theme-primary)">{% translate "Privacy Policy" %}</a>
                    <a href="{% url 'django.contrib.flatpages.views.flatpage' url='/terms-of-service/' %}"
                       class="hover:underline"
                       style="color: var(--theme-primary)">{% translate "Terms of Service" %}</a>
                </div>
            </div>
        </footer>
        <!-- Scripts -->
        <script src="{% static 'vendor/htmx.min.js' %}"></script>
        <!-- Theme Switcher Script -->
        <script>
            function setTheme(theme) {
                if (theme === 'system') {
                    localStorage.removeItem('theme');
                    document.documentElement.removeAttribute('data-theme');
                } else {
                    localStorage.setItem('theme', theme);
                    document.documentElement.setAttribute('data-theme', theme);
                }
            }

            function initThemeSwitcher() {
                var current = localStorage.getItem('theme') || 'system';
                var radio = document.querySelector('input[name="theme"][value="' + current + '"]');
                if (radio) radio.checked = true;

                document.querySelectorAll('input[name="theme"]').forEach(function(input) {
                    input.addEventListener('change', function() {
                        setTheme(this.value);
                    });
                });
            }

            document.addEventListener('DOMContentLoaded', initThemeSwitcher);
        </script>
        {% block extra_scripts %}
        {% endblock extra_scripts %}
    </body>
</html>
