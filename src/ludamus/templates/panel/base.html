{% load i18n %}
{% load static %}
{% load heroicons %}
{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            {% block title %}
                Ludamus Backoffice
            {% endblock title %}
        </title>
        <meta name="description"
              content="Ludamus backoffice panel for event management">
        <meta name="keywords" content="ludamus, backoffice, events, management">
        <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
        <script src="{% static 'vendor/tailwind.min.js' %}"></script>
        <script src="{% static 'vendor/htmx.min.js' %}"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: '#6366f1',
                            secondary: '#8b5cf6',
                        }
                    }
                }
            }
        </script>
        <style>
            .sidebar-overlay {
                transition: opacity 0.3s ease-in-out;
            }

            .sidebar-panel {
                transition: transform 0.3s ease-in-out;
            }
        </style>
        {% block extra_head %}
        {% endblock extra_head %}
    </head>
    <body class="bg-gray-50 min-h-screen">
        <div class="flex min-h-screen">
            <!-- Mobile Sidebar Overlay -->
            <div id="sidebarOverlay"
                 class="sidebar-overlay fixed inset-0 bg-black/50 z-40 lg:hidden hidden"
                 hx-on:click="document.getElementById('sidebar').classList.toggle('-translate-x-full'); this.classList.toggle('hidden')">
            </div>
            <!-- Sidebar -->
            <aside id="sidebar"
                   class="sidebar-panel w-64 bg-gray-900 text-white flex-shrink-0 fixed h-full z-50 -translate-x-full lg:translate-x-0 overflow-y-auto">
                <div class="p-6">
                    <h1 class="text-2xl font-bold text-primary">Ludamus</h1>
                    <p class="text-gray-400 text-sm">Backoffice</p>
                </div>
                <!-- Event Selector -->
                {% if events %}
                    <div class="px-4 mb-6">
                        <label class="text-xs text-gray-500 uppercase tracking-wider">{% translate "Event" %}</label>
                        <select id="eventSelector"
                                class="mt-1 w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary"
                                hx-on:change="window.location.href = '/panel/event/' + this.value + '/'">
                            {% for event in events %}
                                <option value="{{ event.slug }}"
                                        {% if current_event and current_event.slug == event.slug %}selected{% endif %}>
                                    {{ event.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}
                <nav class="px-4 space-y-1">
                    {% block sidebar_nav %}
                        <a href="{% url 'panel:event-index' slug=current_event.slug %}"
                           class="flex items-center px-4 py-3 {% if active_nav == 'index' %}text-white bg-gray-800{% else %}text-gray-300 hover:bg-gray-800{% endif %} rounded-lg transition">
                            {% heroicon_outline "home" class="w-5 h-5 mr-3" %}
                            {% translate "Dashboard" %}
                        </a>
                        <a href="{% url 'panel:cfp' slug=current_event.slug %}"
                           class="flex items-center px-4 py-3 {% if active_nav == 'cfp' %}text-white bg-gray-800{% else %}text-gray-300 hover:bg-gray-800{% endif %} rounded-lg transition">
                            {% heroicon_outline "rectangle-stack" class="w-5 h-5 mr-3" %}
                            {% translate "Call for Proposals" %}
                        </a>
                        <div class="pt-4 mt-4 border-t border-gray-800">
                            <p class="px-4 text-xs text-gray-500 uppercase tracking-wider mb-2">{% translate "Settings" %}</p>
                            <a href="{% url 'panel:event-settings' slug=current_event.slug %}"
                               class="flex items-center px-4 py-3 {% if active_nav == 'settings' %}text-white bg-gray-800{% else %}text-gray-300 hover:bg-gray-800{% endif %} rounded-lg transition">
                                {% heroicon_outline "cog-6-tooth" class="w-5 h-5 mr-3" %}
                                {% translate "Event Settings" %}
                            </a>
                        </div>
                    {% endblock sidebar_nav %}
                </nav>
                <div class="absolute bottom-0 w-64 p-4 border-t border-gray-800 bg-gray-900">
                    <a href="{% url 'web:index' %}"
                       class="flex items-center px-4 py-2 mb-4 text-gray-300 hover:text-white hover:bg-gray-800 rounded-lg transition">
                        {% heroicon_outline "arrow-left" class="w-5 h-5 mr-3" %}
                        {% translate "Back to website" %}
                    </a>
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center flex-shrink-0">
                            <span class="text-white font-medium">{{ request.user.username|first|upper|default:"?" }}</span>
                        </div>
                        <div class="ml-3 min-w-0">
                            <p class="text-sm font-medium truncate">{{ request.user.username }}</p>
                            <p class="text-xs text-gray-400 truncate">{% translate "Organizer" %}</p>
                        </div>
                    </div>
                </div>
            </aside>
            <!-- Main Content -->
            <main class="flex-1 lg:ml-64">
                <!-- Top Bar -->
                <header class="bg-white border-b border-gray-200 px-3 sm:px-4 lg:px-8 py-3 sm:py-4 sticky top-0 z-10">
                    <div class="flex items-center justify-between gap-4">
                        <!-- Mobile menu button -->
                        <button hx-on:click="document.getElementById('sidebar').classList.toggle('-translate-x-full'); document.getElementById('sidebarOverlay').classList.toggle('hidden')"
                                class="lg:hidden p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg flex-shrink-0">
                            {% heroicon_outline "bars-3" class="w-6 h-6" %}
                        </button>
                        <div class="flex-1 min-w-0">
                            <h2 class="text-xl lg:text-2xl font-bold text-gray-900 truncate">
                                {% block page_title %}
                                    {% translate "Dashboard" %}
                                {% endblock page_title %}
                            </h2>
                            <p class="text-gray-500 text-sm lg:text-base truncate">
                                {% block page_subtitle %}
                                    {% if current_event %}{{ current_event.name }}{% endif %}
                                {% endblock page_subtitle %}
                            </p>
                        </div>
                        {% block header_actions %}
                            <div class="hidden sm:flex items-center space-x-4 flex-shrink-0">
                                {% if current_event %}
                                    <span class="text-sm text-gray-500 hidden md:inline">
                                        {% translate "Event:" %} <strong>{{ current_event.start_time|date:"d M" }} - {{ current_event.end_time|date:"d M Y" }}</strong>
                                    </span>
                                    {% if is_proposal_active %}
                                        <span class="px-3 py-1 bg-green-100 text-green-700 text-sm rounded-full whitespace-nowrap">{% translate "Proposals Open" %}</span>
                                    {% else %}
                                        <span class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full whitespace-nowrap">{% translate "Proposals Closed" %}</span>
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% endblock header_actions %}
                    </div>
                </header>
                <!-- Messages -->
                {% if messages %}
                    <div class="p-3 sm:p-4 lg:px-8 lg:pt-4 lg:pb-0 space-y-2">
                        {% for message in messages %}
                            <div class="{% if message.tags == 'error' %}bg-red-50 border-red-200 text-red-800{% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-200 text-yellow-800{% elif message.tags == 'success' %}bg-green-50 border-green-200 text-green-800{% else %}bg-blue-50 border-blue-200 text-blue-800{% endif %} border rounded-lg p-4 flex items-start">
                                {% if message.tags == 'error' %}
                                    {% heroicon_outline "exclamation-triangle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                                {% elif message.tags == 'warning' %}
                                    {% heroicon_outline "exclamation-triangle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                                {% elif message.tags == 'success' %}
                                    {% heroicon_outline "check-circle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                                {% else %}
                                    {% heroicon_outline "information-circle" class="w-5 h-5 mr-3 flex-shrink-0" %}
                                {% endif %}
                                <span>{{ message }}</span>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                <div class="p-3 sm:p-4 lg:p-8">
                    {% block content %}
                    {% endblock content %}
                </div>
            </main>
        </div>
        {% block extra_scripts %}
        {% endblock extra_scripts %}
    </body>
</html>
