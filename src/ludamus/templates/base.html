{% load i18n %}
{% load django_bootstrap5 %}
{% load bootstrap_icons %}
{% load static %}
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Event webapp">
        <meta name="keywords"
              content="events, conferences, workshops, seminars, meetups, registration, enrollment, sessions, networking, professional development, tech events, design workshops, free events">
        <title>
            {% block title %}
            {% endblock title %}
        </title>
        <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
        <link rel="shortcut icon"
              type="image/x-icon"
              href="{% static 'favicon.ico' %}">
        {% bootstrap_css %}
        <link rel="stylesheet" href="{% static 'css/common.css' %}">
        <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
        <link rel="stylesheet" href="{% static 'css/cinematic-card.css' %}">
        <link rel="stylesheet" href="{% static 'css/themes/cold-steel.css' %}">
        <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    </head>
    <body>
        {% block page_nav_bg %}
        <div class="page-nav-bg"></div>
        {% endblock page_nav_bg %}
        <header class="page-nav container-fluid">
            <a class="page-nav__brand"
               href="{{ request.scheme }}://{{ current_site.domain }}{% url 'web:index' %}">
                {{ current_sphere.name }}
            </a>

            <button class="page-nav__toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="page-nav-menu">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="32" height="32" fill="currentColor">
                    <rect width="256" height="256" fill="none"/>
                    <line x1="40" y1="128" x2="216" y2="128" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                    <line x1="40" y1="64" x2="216" y2="64" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                    <line x1="40" y1="192" x2="216" y2="192" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                </svg>
            </button>

            <div class="page-nav-overlay" id="page-nav-overlay"></div>

            <nav class="page-nav__menu" id="page-nav-menu" aria-hidden="true">
                <ul class="page-nav__list">
                    <li class="page-nav__item">
                        <a href="https://github.com/fancysnake/ludamus" class="page-nav__link" target="_blank" rel="noopener noreferrer">
                            GitHub
                        </a>
                    </li>
                    <li class="page-nav__item">
                        <a href="mailto:{{ SUPPORT_EMAIL }}" class="page-nav__link">
                            Contact
                        </a>
                    </li>

                    {% if request.user.is_authenticated and request.user.name %}
                        <li class="page-nav__item">
                            <span class="page-nav__link">
                                {{ request.user.name }}
                            </span>
                        </li>
                    {% endif %}
                    
                    {% if request.user.is_authenticated %}
                        <li class="page-nav__item">
                            <a class="page-nav__btn page-nav__btn--outline"
                               href="{% url 'web:crowd:profile' %}">
                                {% translate "Edit Profile" %}
                            </a>
                        </li>
                        <li class="page-nav__item">
                            <a class="page-nav__btn page-nav__btn--outline"
                               href="{% url 'web:crowd:auth0:logout' %}">
                                {% translate "Logout" %}
                            </a>
                        </li>
                    {% else %}
                        <li class="page-nav__item">
                            <a class="page-nav__btn page-nav__btn--login text-dark"
                               href="{% url 'web:crowd:auth0:login' %}?next={{ request.build_absolute_uri }}">
                                {% translate "Login" %}
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </header>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // Elements
                const toggle = document.querySelector('.page-nav__toggle');
                const nav = document.querySelector('.page-nav__menu');
                const overlay = document.querySelector('.page-nav-overlay');
                const body = document.body;

                // Mobile menu toggle
                function toggleMenu() {
                    const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
                    toggle.setAttribute('aria-expanded', !isExpanded);
                    nav.setAttribute('aria-hidden', isExpanded);
                    overlay.classList.toggle('is-visible');
                    body.style.overflow = isExpanded ? '' : 'hidden';
                }

                toggle.addEventListener('click', toggleMenu);
                overlay.addEventListener('click', toggleMenu);
                
                // Close menu on escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && nav.getAttribute('aria-hidden') === 'false') {
                        toggleMenu();
                    }
                });
            });
        </script>
    {% if messages %}
        <div class="mt-3">
            {% for message in messages %}
                {% if message.tags == 'error' %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        {% bs_icon 'exclamation-triangle-fill' %}
                        {{ message }}
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="alert"
                                aria-label="Close"></button>
                    </div>
                {% elif message.tags == 'warning' %}
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        {% bs_icon 'exclamation-triangle' %}
                        {{ message }}
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="alert"
                                aria-label="Close"></button>
                    </div>
                {% elif message.tags == 'success' %}
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        {% bs_icon 'check-circle-fill' %}
                        {{ message }}
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="alert"
                                aria-label="Close"></button>
                    </div>
                {% elif message.tags == 'info' %}
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        {% bs_icon 'info-circle-fill' %}
                        {{ message }}
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="alert"
                                aria-label="Close"></button>
                    </div>
                {% else %}
                    <div class="alert alert-secondary alert-dismissible fade show"
                         role="alert">
                        {% bs_icon 'chat-dots' %}
                        {{ message }}
                        <button type="button"
                                class="btn-close"
                                data-bs-dismiss="alert"
                                aria-label="Close"></button>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
    <div class="main-content content-section">
        {% block body %}
        {% endblock body %}
    </div>
    <footer class="page-footer bg-body-secondary py-4">
        <div>
            <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between gap-2">
                <div>
                    <p class="mb-0">
                        © 2025 Radosław Ganczarek. <br class="d-md-none" /><a href="https://github.com/fancysnake/ludamus">Source code</a> available under BSD-3-Clause license.
                    </p>
                </div>
                <div>
                    <a href="mailto:{{ SUPPORT_EMAIL }}" class="text-decoration-none me-3">{% translate "Contact me" %}</a>
                    <a href="{% url 'django.contrib.flatpages.views.flatpage' url='/privacy-policy/' %}"
                       class="text-decoration-none me-3">{% translate "Privacy Policy" %}</a>
                    <a href="{% url 'django.contrib.flatpages.views.flatpage' url='/terms-of-service/' %}"
                       class="text-decoration-none">{% translate "Terms of Service" %}</a>
                </div>
            </div>
        </div>
    </footer>
    {% bootstrap_javascript %}
</body>
</html>
